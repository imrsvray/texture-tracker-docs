<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd"><html>
<head>
  <title>vplibs - header</title>
  <meta name="GENERATOR" content="Quanta Plus">
  <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
</head>
<body>
 <table>
  <tbody>
<tr align="left" valign="top" bgcolor="#ccffff">
<td width="100%">
<table>
  <tbody>
    <tr>
      <td> <a href="/project/vp/vplibs/index.html"><h3> BBC R&amp;D VP
Libraries: </h3></a></td> 
      <td> <a href="/project/vp/vplibs/soGeM/doc/index.html">soGeM</a> |
</td>
      <td> <a 
href="/project/vp/vplibs/VPtexturing/doc/index.html">VPtexturing</a> |
</td>

	<td> <a href="/project/vp/vplibs/VPgeom/doc/index.html">VPgeom</a> |
</td>      
	<td> <a href="/project/vp/vplibs/VPio/doc/index.html">VPio</a> | </td>
	<td> <a href="/project/vp/vplibs/VPip/doc/index.html">VPip</a> | </td>
	<td> <a href="/project/vp/vplibs/VPutil/doc/index.html">VPutil</a> | </td>
        <td> VPai | </td>
      <td> DVSlib | </td>
    </tr>
  </tbody>
</table>
</td>
</tr>
<tr align="left" valign="top" bgcolor="#FFFFFF#ccffff">
<td width="100%">

<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a></div>
<h1>nd_array.cc</h1><div class="fragment"><pre>00001 <span class="comment">/* n-d array</span>
00002 <span class="comment"> *</span>
00003 <span class="comment"> * Phil Tudor, BBC R&amp;D</span>
00004 <span class="comment"> * with pictool-related bits removed by GAT 24-1-02</span>
00005 <span class="comment"> */</span>
00006         
00007 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
00008 <span class="preprocessor">#include &lt;malloc.h&gt;</span>
00009 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00010 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00011 
00012 <span class="preprocessor">#include "nd_array.h"</span>
00013 
00014 <span class="keyword">using</span> <span class="keyword">namespace </span>bbcvp;
00015 
00016 <span class="keywordtype">void</span>* <a class="codeRef" doxygen="soGeM.tags:/project/vp/vplibs/soGeM/doc/" href="/project/vp/vplibs/soGeM/doc/namespacebbcvp.html#a1">bbcvp::alloc_nd</a> (<span class="keywordtype">int</span> size, <span class="keywordtype">int</span> n, ...)
00017 {
00018         <span class="keywordtype">int</span> i, k, l, size_i, p;
00019         <span class="keywordtype">void</span> *base, **prev_base;
00020   va_list ap;
00021         
00022   va_start (ap, n);
00023 
00024         p=1;
00025         prev_base=&amp;base;
00026         size_i=<span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *);
00027         
00028         <span class="keywordflow">for</span> (i=1; i&lt;=n; i++) {
00029                 l=va_arg (ap, <span class="keywordtype">int</span>);
00030 
00031                 <span class="keywordflow">if</span> (i==n)
00032                         size_i=size;
00033                 
00034                 <span class="keywordflow">if</span> ((prev_base[0]=malloc(p*l*size_i))==NULL)
00035                 {
00036                         fprintf(stderr, <span class="stringliteral">"alloc_nd: Out of memory, %d of %d-d"</span>, i, n);
00037                         exit (-1);
00038                 }
00039 
00040                 <span class="keywordflow">if</span> (i&gt;1)
00041                         <span class="keywordflow">for</span> (k=1; k&lt;p; k++)
00042                                 prev_base[k]=(<span class="keywordtype">char</span> *)prev_base[0]+k*l*size_i;
00043 
00044                 prev_base = (<span class="keywordtype">void</span> **)prev_base[0];
00045                 p *= l;
00046         }                               
00047                                 
00048         va_end (ap);
00049 
00050         <span class="keywordflow">return</span> (base);
00051 }
00052                 
00053 <span class="comment">/****************************************************************************/</span>
00054 
00055 <span class="keywordtype">void</span> bbcvp::free_nd (<span class="keywordtype">void</span> *base, <span class="keywordtype">int</span> n)
00056 {
00057         <span class="keywordflow">if</span> (n&gt;1)
00058                 free_nd (*(<span class="keywordtype">void</span> **)base, n-1);
00059         free (base);
00060 }
</pre></div></td>
</tr>
  </tbody>
</table>
</body>
</html>
